# Google Sheets 웹훅 전송 Apps Script

Google 스프레드시트의 모든 셀 변경을 감지하고 웹훅으로 데이터를 전송하는 Apps Script입니다.

## 주요 기능

- 📝 **모든 셀 변경 감지**: 특정 컬럼에 제한 없이 모든 셀 변경 감지
- 🔄 **이전 값 추적**: PropertiesService를 사용한 이전 값 저장 및 비교
- 📊 **전체 행 데이터 수집**: 변경된 행의 모든 데이터를 객체로 구성
- 🚀 **웹훅 자동 전송**: JSON 형태로 외부 서버에 실시간 데이터 전송
- 🛡️ **에러 처리**: 안정적인 실행을 위한 에러 처리 및 로깅

## 설치 및 설정 방법

### 1. Google Apps Script 프로젝트 생성

1. [Google Apps Script](https://script.google.com/) 접속
2. "새 프로젝트" 클릭
3. 프로젝트 이름 변경 (예: "스프레드시트 웹훅")

### 2. 스크립트 코드 추가

1. `Code.gs` 파일에 제공된 스크립트 코드 복사/붙여넣기
2. **웹훅 URL 설정**: 코드 상단의 `WEBHOOK_URL` 변수를 실제 웹훅 URL로 변경
   ```javascript
   const WEBHOOK_URL = 'https://your-webhook-url.com/api/webhook';
   ```

### 3. 권한 설정

1. "저장" 버튼 클릭 (Ctrl+S)
2. 첫 실행 시 권한 승인 요청 - "권한 승인" 클릭
3. Google 계정으로 로그인 후 "허용" 클릭

### 4. 설치 가능한 트리거 추가

1. 좌측 메뉴에서 "트리거" (시계 아이콘) 클릭
2. "트리거 추가" 버튼 클릭
3. 다음과 같이 설정:
   - **실행할 함수**: `onEditInstallable`
   - **이벤트 소스**: `스프레드시트에서`
   - **이벤트 유형**: `편집 시`
   - **실패 시 알림 설정**: 필요에 따라 설정
4. "저장" 클릭

### 5. 초기 셀 값 설정 (선택사항)

기존 데이터가 있는 스프레드시트의 경우:
1. `initializeCellValues` 함수 실행
2. 상단 메뉴에서 "함수 실행" > `initializeCellValues` 선택

## 전송되는 JSON 데이터 형식

```json
{
  "sheetName": "시트1",
  "spreadsheetName": "20250825",
  "spreadsheetId": "1Xb0jJIAl1VO8e6vhPifnr-XX2Jo03bGZHwaYzMut7WU",
  "columnName": "배송상태",
  "rowIndex": 2,
  "oldValue": "배송 준비중",
  "newValue": "배송 완료",
  "rowData": {
    "배송지": "수원시 장안구 수성로 157번길 60",
    "고객명": "1번 고객",
    "고객 연락처": "01030917061",
    "배송 담당자": "박국철",
    "배송상태": "배송 완료"
  }
}
```

### 데이터 필드 설명

| 필드 | 타입 | 설명 |
|------|------|------|
| `sheetName` | String | 변경이 발생한 시트명 |
| `spreadsheetName` | String | 스프레드시트 이름 |
| `spreadsheetId` | String | 스프레드시트 고유 ID |
| `columnName` | String | 변경된 컬럼의 헤더명 |
| `rowIndex` | Number | 변경된 행 번호 (1부터 시작) |
| `oldValue` | String | 변경 전 값 |
| `newValue` | String | 변경 후 값 |
| `rowData` | Object | 해당 행의 모든 데이터 (헤더:값 매핑) |

## 사용 방법

### 1. 일반 사용

트리거 설정 후에는 스프레드시트에서 셀을 편집할 때마다 자동으로 웹훅이 전송됩니다.

### 2. 테스트 실행

웹훅이 제대로 작동하는지 테스트하려면:
1. Apps Script 에디터에서 `testWebhook` 함수 실행
2. 로그에서 결과 확인

### 3. 로그 확인

1. Apps Script 에디터에서 "실행" 탭 클릭
2. 최근 실행 내역 및 로그 확인

## 주의사항 및 제한사항

### ⚠️ 주의사항

1. **헤더 행 변경 무시**: 첫 번째 행(헤더) 변경은 웹훅을 전송하지 않습니다
2. **웹훅 URL 필수**: `WEBHOOK_URL`을 실제 URL로 변경해야 웹훅이 전송됩니다
3. **네트워크 오류**: 웹훅 전송 실패 시 로그에서 오류 내용을 확인할 수 있습니다

### 📋 제한사항

1. **Google Apps Script 제한**: 일일 실행 시간 및 API 호출 횟수 제한 적용
2. **트리거 응답 시간**: 대량 편집 시 트리거 실행에 지연이 있을 수 있습니다
3. **PropertiesService 저장소 크기**: 대용량 스프레드시트에서는 저장소 제한에 주의

## 문제 해결

### 웹훅이 전송되지 않는 경우

1. **트리거 확인**: 설치 가능한 트리거가 올바르게 설정되었는지 확인
2. **권한 확인**: 스크립트에 필요한 권한이 승인되었는지 확인
3. **웹훅 URL 확인**: URL이 올바르게 설정되고 접근 가능한지 확인
4. **로그 확인**: 실행 로그에서 오류 메시지 확인

### 성능 최적화

대량 데이터 처리 시 성능을 향상시키려면:
1. 불필요한 셀 변경을 최소화
2. 배치 편집 대신 개별 셀 편집 권장
3. 웹훅 서버의 응답 시간 최적화

## 라이선스

이 코드는 자유롭게 사용, 수정, 배포할 수 있습니다.